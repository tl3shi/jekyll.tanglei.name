<!DOCTYPE html>
<html lang="zh_cn">
  <head>
    <title>关联规则-Apriori算法详解(附python版源码)</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="keywords" content="关联规则-Apriori算法详解(附python版源码), 我不会算法, Python,数据挖掘,, 唐磊, 中南大学, 清华大学, 软件工程师, 计算机, 全栈工程师" />
    <meta name="description" content="关联规则-Apriori算法详解(附python版源码), 我不会算法, Python,数据挖掘, Apriori algorithm是关联规则里一项基本算法。是由Rakesh Agrawal和Ramakrishnan Srikant两位在1994年提出的布尔关联规则的频繁项集挖掘算法(详情：Fast Algorithms for Mining Association Rules)。算法的名字是因为算法基于先验..." />

    <link rel="shortcut icon" href="/assets/favicon.ico" type="image/x-icon" />

  <!--Font awesome-->
  <link href="/assets/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet">

  <!-- The pithy main css -->
  <link rel="stylesheet" href="/assets/stylesheet/pithy.css">
  <link rel="stylesheet" href="/assets/stylesheet/molokai.css">


  <!--[if lt IE 9]>
  <script src="https://cdn.bootcss.com/html5shiv/3.7.2/html5shiv-printshiv.js"></script>
  <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.js"></script>
  <![endif]-->
  <link rel="alternate" type="application/rss+xml" title="tanglei's blog|唐磊的个人博客" href="https://www.tanglei.name/feed.xml" />
</head>

<body>
  <nav class="navbar navbar-pithy" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" 
                data-target="#pithy-navbar" aria-expanded="false">
                <i class="fa fa-bars"></i>
            </button>
            <a class="navbar-brand" rel="bookmark" href="/">TangLei</a>
        </div>

        <div class="collapse navbar-collapse" id="pithy-navbar">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a rel="bookmark" href="/">首页</a>
                </li>
                <li class="active">
                    <a rel="bookmark" href="/archives.html">Archives</a>
                </li>
                <li class="active">
                    <a rel="bookmark" href="/about/">关于</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


  <div class="container page-content">
    <div>
    <div class="col-md-9 col-content">
        <div id="post-content" class="panel panel-pithy post">
            <div class="panel-heading">
                <div class="title">
                  <i class="fa fa-bookmark-o"></i>关联规则-Apriori算法详解(附python版源码)
                </div>
                <ul class="info">
                    <li>
                      作者 <span class="author"> 
        
            tanglei
        
        </span>
                    </li>
                    <li>
                      最后编辑 2012年03月17日
                    </li>
                    <li>
                      Tags
                     
                         <a class="tag" href="/tag/#Python">Python</a>
                     
                         <a class="tag" href="/tag/#数据挖掘">数据挖掘</a>
                     
                    </li>
                </ul>
            </div>
            <div class="panel-body content">
                <p>Apriori algorithm是关联规则里一项基本算法。是由Rakesh Agrawal和Ramakrishnan Srikant两位在1994年提出的布尔关联规则的频繁项集挖掘算法(详情：<a href="http://rakesh.agrawal-family.com/papers/vldb94apriori.pdf" target="_blank">Fast Algorithms for Mining Association Rules</a>)。算法的名字是因为算法基于先验知识(prior knowledge).根据前一次找到的频繁项来生成本次的频繁项。关联规则的目的在于在一个数据集中找出项之间的关系，也称之为购物蓝分析 (market basket analysis)。例如，购买佳能的顾客，有70%的可能也会买在一个月之类买HP打印机。这其中最有名的例子就是”<a href="http://baike.baidu.com/view/1978239.htm" target="_blank">尿布和啤酒</a>“的故事了。</p>

<p>几个概念：</p>

<table>
  <tbody>
    <tr>
      <td>关联规则A-&gt;B的<strong>支持度</strong>support=P(AB)，指的是事件A和事件B同时发生的概率。<strong>置信度</strong>confidence=P(B</td>
      <td>A)=P(AB)/P(A),指的是发生事件A的基础上发生事件B的概率。比如说在规则Computer =&gt; antivirus_software , 其中 support=2%, confidence=60%中，就表示的意思是所有的商品交易中有2%的顾客同时买了电脑和杀毒软件，并且购买电脑的顾客中有60%也购买了杀毒软件。</td>
    </tr>
  </tbody>
</table>

<p>如果事件A中包含k个元素，那么称这个事件A为<strong>k</strong><strong>项集，</strong>并且事件A满足最小支持度阈值的事件称为<strong>频繁</strong><strong>k</strong><strong>项集</strong>。</p>

<p>Apriori算法的基本思想：</p>

<p>过程分为两个步骤：第一步通过迭代，检索出事务数据库中的所有频繁项集，即支持度不低于用户设定的阈值的项集；第二步利用频繁项集构造出满足用户最小信任度的规则。具体做法就是：首先找出频繁1-项集，记为L<sub>1</sub>；然后利用L<sub>1</sub>来产生候选项集C<sub>2</sub>，对C<sub>2</sub>中的项进行判定挖掘出L<sub>2</sub>，即频繁2-项集；不断如此循环下去直到无法发现更多的频繁k-项集为止。每挖掘一层L<sub>k</sub>就需要扫描整个数据库一遍。算法利用了一个性质：<strong>Apriori 性质</strong>：任一频繁项集的所有非空子集也必须是频繁的。意思就是说，生成一个k-itemset的候选项时，如果这个候选项有子集不在(k-1)-itemset(已经确定是frequent的)中时，那么这个候选项就不用拿去和支持度判断了，直接删除。具体而言：</p>

<p>1） 连接步</p>

<p>为找出L<sub>k</sub>（所有的频繁k项集的集合），通过将L<sub>k-1</sub>（所有的频繁k-1项集的集合）与自身连接产生候选k项集的集合。候选集合记作C<sub>k</sub>。设l<sub>1</sub>和l<sub>2</sub>是L<sub>k-1</sub>中的成员。记l<sub>i</sub>[j]表示l<sub>i</sub>中的第j项。假设Apriori算法对事务或项集中的项按字典次序排序，即对于（k-1）项集l<sub>i</sub>，l<sub>i</sub>[1]&lt;l<sub>i</sub>[2]&lt;……….&lt;l<sub>i</sub>[k-1]。将L<sub>k-1</sub>与自身连接，如果(l<sub>1</sub>[1]=l<sub>2</sub>[1])&amp;&amp;( l<sub>1</sub>[2]=l<sub>2</sub>[2])&amp;&amp;……..&amp;&amp; (l<sub>1</sub>[k-2]=l<sub>2</sub>[k-2])&amp;&amp;(l<sub>1</sub>[k-1]&lt;l<sub>2</sub>[k-1])，那认为l<sub>1</sub>和l<sub>2</sub>是可连接。连接l<sub>1</sub>和l<sub>2</sub> 产生的结果是{l<sub>1</sub>[1],l<sub>1</sub>[2],……,l<sub>1</sub>[k-1],l<sub>2</sub>[k-1]}。</p>

<p>2） 剪枝步</p>

<p>C<sub>K</sub>是L<sub>K</sub>的超集，也就是说，C<sub>K</sub>的成员可能是也可能不是频繁的。通过扫描所有的事务（交易），确定C<sub>K</sub>中每个候选的计数，判断是否小于最小支持度计数，如果不是，则认为该候选是频繁的。为了压缩C<sub>k</sub>,可以利用Apriori性质：任一频繁项集的所有非空子集也必须是频繁的，反之，如果某个候选的非空子集不是频繁的，那么该候选肯定不是频繁的，从而可以将其从C<sub>K</sub>中删除。</p>

<p>算法伪代码如下：</p>

<div class="language-pascal highlighter-rouge"><pre class="highlight"><code><span class="c1">//算法：Apriori
//输入：D - 事务数据库；min_sup - 最小支持度计数阈值
//输出：L - D中的频繁项集
//方法：
</span>     <span class="n">L1</span><span class="p">=</span><span class="n">find_frequent_1</span><span class="p">-</span><span class="n">itemsets</span><span class="p">(</span><span class="n">D</span><span class="p">);</span> <span class="c1">// 找出所有频繁1项集
</span>     <span class="k">For</span><span class="p">(</span><span class="n">k</span><span class="p">=</span><span class="m">2</span><span class="p">;</span><span class="n">Lk</span><span class="p">-</span><span class="m">1</span><span class="p">!=</span><span class="n">null</span><span class="p">;</span><span class="n">k</span><span class="p">++)</span><span class="cm">{
        Ck=apriori_gen(Lk-1); // 产生候选，并剪枝
        For each 事务t in D{ // 扫描D进行候选计数
            Ct =subset(Ck,t); // 得到t的子集
            For each 候选c 属于 Ct
                         c.count++;
        }</span>
        <span class="n">Lk</span><span class="p">=</span><span class="cm">{c属于Ck | c.count&gt;=min_sup}</span>
<span class="p">}</span>
<span class="n">Return</span> <span class="n">L</span><span class="p">=</span><span class="err">所有的频繁集；</span>
 
<span class="k">Procedure</span> <span class="n">apriori_gen</span><span class="p">(</span><span class="n">Lk</span><span class="p">-</span><span class="m">1</span><span class="p">:</span><span class="n">frequent</span><span class="p">(</span><span class="n">k</span><span class="p">-</span><span class="m">1</span><span class="p">)-</span><span class="n">itemsets</span><span class="p">)</span>
      <span class="k">For</span> <span class="n">each</span><span class="err">项集</span><span class="n">l1</span><span class="err">属于</span><span class="n">Lk</span><span class="p">-</span><span class="m">1</span>
              <span class="k">For</span> <span class="n">each</span><span class="err">项集</span> <span class="n">l2</span><span class="err">属于</span><span class="n">Lk</span><span class="p">-</span><span class="m">1</span>
                       <span class="k">If</span><span class="p">((</span><span class="n">l1</span><span class="p">[</span><span class="m">1</span><span class="p">]=</span><span class="n">l2</span><span class="p">[</span><span class="m">1</span><span class="p">])&amp;&amp;(</span> <span class="n">l1</span><span class="p">[</span><span class="m">2</span><span class="p">]=</span><span class="n">l2</span><span class="p">[</span><span class="m">2</span><span class="p">])&amp;&amp;</span><span class="err">……</span><span class="p">..</span>
<span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">l1</span><span class="p">[</span><span class="n">k</span><span class="p">-</span><span class="m">2</span><span class="p">]=</span><span class="n">l2</span><span class="p">[</span><span class="n">k</span><span class="p">-</span><span class="m">2</span><span class="p">])&amp;&amp;(</span><span class="n">l1</span><span class="p">[</span><span class="n">k</span><span class="p">-</span><span class="m">1</span><span class="p">]&lt;</span><span class="n">l2</span><span class="p">[</span><span class="n">k</span><span class="p">-</span><span class="m">1</span><span class="p">]))</span> <span class="k">then</span><span class="cm">{
                   c=l1连接l2 //连接步：产生候选
                   if has_infrequent_subset(c,Lk-1) then
                       delete c; //剪枝步：删除非频繁候选
                   else add c to Ck;
                  }</span>
          <span class="n">Return</span> <span class="n">Ck</span><span class="p">;</span>
 
     <span class="k">Procedure</span> <span class="n">has_infrequent_sub</span><span class="p">(</span><span class="n">c</span><span class="p">:</span><span class="n">candidate</span> <span class="n">k</span><span class="p">-</span><span class="n">itemset</span><span class="p">;</span> <span class="n">Lk</span><span class="p">-</span><span class="m">1</span><span class="p">:</span><span class="n">frequent</span><span class="p">(</span><span class="n">k</span><span class="p">-</span><span class="m">1</span><span class="p">)-</span><span class="n">itemsets</span><span class="p">)</span>
        <span class="k">For</span> <span class="n">each</span><span class="p">(</span><span class="n">k</span><span class="p">-</span><span class="m">1</span><span class="p">)-</span><span class="n">subset</span> <span class="n">s</span> <span class="k">of</span> <span class="n">c</span>
            <span class="k">If</span> <span class="n">s</span><span class="err">不属于</span><span class="n">Lk</span><span class="p">-</span><span class="m">1</span> <span class="k">then</span>
               <span class="n">Return</span> <span class="nb">true</span><span class="p">;</span>
        <span class="n">Return</span> <span class="nb">false</span><span class="p">;</span>
</code></pre>
</div>

<p>举个例子,来源于书中(见参考文献1)的例子。</p>

<p><a href="/wp-content/uploads/2012/03/image1.png"><img title="apriori算法" src="/wp-content/uploads/2012/03/image_thumb1.png" alt="apriori算法" data-pinit="registered" /></a></p>

<p>如图中所示,有9个事务，其算法流程如下：</p>

<p><img src="http://i1123.photobucket.com/albums/l549/tl3shi/apriori.jpg" alt="apriori算法,关联规则,数据挖掘" /></p>

<p>以上就有了频繁项集，然后根据得到的频繁项集和给定置信度算关联规则。置信度其实是一个条件概率。关联规则产生就是根据每个生成的频繁项集，产生其所有非空子集，然后根据子集和原来的事务库中循环比较。大于给定重复次数的就是满足条件的。例如针对频繁集{I1，I2，I5}。可以产生哪些关联规则？该频繁集的非空真子集（求子集的具体方法在前面<a href="/blog/a-python-problem-about-a-plusequal-b-and-a-equal-a-plus-b.html" target="_blank">python中a+=b和a=a+b的问题</a>中已经阐述）有{I1，I2}，{I1，I5}，{I2，I5}，{I1 }，{I2}和{I5}，对应置信度如下：</p>

<p align="center">
  I1&amp;&amp;I2-&gt;I5 confidence=2/4=50%
</p>

<p align="center">
  I1&amp;&amp;I5-&gt;I2 confidence=2/2=100%
</p>

<p align="center">
  I2&amp;&amp;I5-&gt;I1 confidence=2/2=100%
</p>

<p align="center">
  I1 -&gt;I2&amp;&amp;I5 confidence=2/6=33%
</p>

<p align="center">
  I2 -&gt;I1&amp;&amp;I5 confidence=2/7=29%
</p>

<p align="center">
  I5 -&gt;I1&amp;&amp;I2 confidence=2/2=100%
</p>

<p>如果min_conf=70%,则强规则有I1&amp;&amp;I5-&gt;I2，I2&amp;&amp;I5-&gt;I1，I5 -&gt;I1&amp;&amp;I2。</p>

<p> </p>

<p>具体而言：因为这几天在学python,所以就用python实现如下。里面有注释，刚开始用python，所以把一些问题也注释在里面了，代码可能不怎么清晰。仅供参考。</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="c"># coding=UTF-8</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="s">'''
Created on Mar 10, 2012

@author: tanglei|www.tanglei.name
'''</span>
<span class="k">class</span> <span class="nc">Item</span><span class="p">:</span>
    <span class="n">elements</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">supp</span><span class="o">=</span><span class="mf">0.0</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">elements</span><span class="p">,</span><span class="n">supp</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supp</span> <span class="o">=</span> <span class="n">supp</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">returnstr</span> <span class="o">=</span> <span class="s">'[ '</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">returnstr</span> <span class="o">+=</span> <span class="n">e</span><span class="o">+</span><span class="s">','</span>
        <span class="n">returnstr</span><span class="o">+=</span><span class="s">' ]'</span><span class="o">+</span><span class="s">' (support :</span><span class="si">%.3</span><span class="s">f)</span><span class="se">\t</span><span class="s">'</span> <span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">supp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">returnstr</span>
    <span class="k">def</span> <span class="nf">getSubset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">size</span><span class="p">):</span>
        <span class="n">subset</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">):</span>
                <span class="n">subset</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
            <span class="k">return</span> <span class="n">subset</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>        
            <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="n">k</span><span class="o">-</span><span class="mi">1</span> <span class="p">:</span>
                <span class="n">myset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSubset</span><span class="p">(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">myset</span><span class="p">):</span>
                    <span class="c">#Attention a+=b  a=a+b  </span>
                    <span class="n">myset</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span>  <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>   <span class="c">#Why Elements change here?</span>
                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">subset</span> <span class="o">+=</span> <span class="p">(</span><span class="n">myset</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">subset</span>
        
    <span class="k">def</span> <span class="nf">lastDiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">items</span><span class="p">):</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">elements</span><span class="p">):</span><span class="c">#length should be the same</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">==</span> <span class="n">items</span><span class="p">:</span><span class="c">#if all the same,return false</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">items</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">setSupport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">supp</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">supp</span> <span class="o">=</span> <span class="n">supp</span>
        
    <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">items</span><span class="p">):</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
        <span class="n">temp</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">),</span> <span class="n">items</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">Item</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">it</span>
<span class="c">#        self.elements.insert(len(self.elements), items.elements[len(items.elements) - 1])#Wrong,if so ,self.elements will change</span>
<span class="c">#        it = Item(self.elements,0.0)</span>
<span class="c">#        print(self.elements)</span>
<span class="c">#        return it</span>
    
<span class="c">#        the following is Wrong ,Because the Constructor Item(),First par is None</span>
<span class="c">#        return copy.deepcopy(Item(\</span>
<span class="c">#                                  self.elements.insert(\</span>
<span class="c">#                                                       len(self.elements), items.elements[len(items.elements) - 1]\</span>
<span class="c">#                                                       )\</span>
<span class="c">#                                  ,0.0)\</span>
<span class="c">#                             )</span>
<span class="k">class</span> <span class="nc">C</span><span class="p">:</span>
    <span class="s">'''candidate '''</span>
    <span class="n">elements</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">#order</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">elements</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">elements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        
    <span class="k">def</span> <span class="nf">isEmpty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="c">#get the same order of itemsets whose support is at lease the threshold</span>
    <span class="k">def</span> <span class="nf">getL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">threshold</span><span class="p">):</span>
        <span class="n">items</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">supp</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">L</span><span class="p">([],</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">L</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">items</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span>   
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">returnstr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s">'-itemset:'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">))</span><span class="o">+</span><span class="s">' </span><span class="se">\r\n</span><span class="s">{ '</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">True</span> <span class="o">==</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span><span class="n">Item</span><span class="p">):</span>
                <span class="n">returnstr</span> <span class="o">+=</span> <span class="n">e</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span>
        <span class="n">returnstr</span> <span class="o">+=</span><span class="s">' }'</span>
        <span class="k">return</span> <span class="n">returnstr</span>
    
<span class="k">class</span> <span class="nc">L</span><span class="p">:</span>
    <span class="s">'''store all the  1-itemsets,2-itemsets,...k-itemsets'''</span>
    <span class="n">items</span><span class="o">=</span><span class="p">[]</span> <span class="c">#all the item in order K</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">0</span>  
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">items</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
    <span class="k">def</span> <span class="nf">has_inFrequentItemsets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
<span class="c">#        return False</span>
<span class="c">#        #先不优化</span>
        <span class="n">subs</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">getSubset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">elements</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">subs</span><span class="p">:</span>
            <span class="n">flag</span><span class="o">=</span><span class="bp">False</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">elements</span><span class="o">==</span><span class="n">each</span><span class="p">:</span>
                    <span class="n">flag</span><span class="o">=</span><span class="bp">True</span>
                    <span class="k">break</span> 
            <span class="k">if</span> <span class="n">flag</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span>
<span class="c">#                print("remove");print(item)</span>
                <span class="k">return</span> <span class="bp">True</span>  
        <span class="k">return</span> <span class="bp">False</span> <span class="c">#there is at least one subset in the freq-items</span>
        
    <span class="k">def</span> <span class="nf">aprioriGen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
        <span class="n">result</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">length</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">length</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">lastDiff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
                    <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                    <span class="k">if</span> <span class="bp">False</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_inFrequentItemsets</span><span class="p">(</span><span class="n">item</span><span class="p">):</span><span class="c">#用Apriori性质：任一频繁项集的所有非空子集也必须是频繁的，反之，如果某个候选的非空子集不是频繁的，那么该候选肯定不是频繁的，从而可以将其从CK中删除。</span>
                        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">C</span><span class="p">([],</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">C</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">returnstr</span><span class="o">=</span><span class="s">"</span><span class="se">\r\n</span><span class="s">"</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s">'-itemsets :'</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">))</span><span class="o">+</span><span class="s">"</span><span class="se">\r\n</span><span class="s">{"</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
            <span class="n">returnstr</span> <span class="o">+=</span> <span class="n">item</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span>
        <span class="n">returnstr</span> <span class="o">+=</span> <span class="s">'}'</span>
        <span class="k">return</span> <span class="n">returnstr</span>
        
<span class="k">class</span> <span class="nc">LS</span><span class="p">:</span>
    <span class="s">'''store from 1-itemset to k-itemset'''</span>
    <span class="n">values</span><span class="o">=</span><span class="p">{}</span><span class="c">#L1,L2,Lk</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">k</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">l</span>
    <span class="k">def</span> <span class="nf">isEmpty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span>    
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">returnstr</span> <span class="o">=</span> <span class="s">'-----result--------</span><span class="se">\r\n</span><span class="s">'</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">returnstr</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">__str__</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">returnstr</span>
<span class="k">class</span> <span class="nc">Rule</span><span class="p">:</span>
    <span class="n">confidence</span><span class="o">=.</span><span class="mi">0</span>
    <span class="n">str_rule</span><span class="o">=</span><span class="s">''</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">confidence</span><span class="p">,</span><span class="n">str_rule</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="n">confidence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">str_rule</span> <span class="o">=</span> <span class="n">str_rule</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">'Rule:'</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">str_rule</span> <span class="o">+</span> <span class="s">'  confidence:'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">confidence</span><span class="p">)</span>
      
<span class="k">class</span> <span class="nc">Apriori</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">min_supp</span><span class="o">=</span><span class="mf">0.07</span><span class="p">,</span><span class="n">datafile</span><span class="o">=</span><span class="s">'apriori.test.data'</span><span class="p">):</span>
        <span class="n">inputfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">datafile</span><span class="p">,</span><span class="s">"r"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_supp</span> <span class="o">=</span> <span class="n">min_supp</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">inputfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
            <span class="n">linearray</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="s">"[</span><span class="err">\</span><span class="s">d]+"</span><span class="p">)</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linearray</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        
    <span class="k">def</span>  <span class="nf">findFrequent1Itemsets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">totalItemsets</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">temp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">totalItemsets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span><span class="c">#store the 1-itemset s</span>
        
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">totalItemsets</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">item</span><span class="o">=</span><span class="n">totalItemsets</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">count</span><span class="o">=</span><span class="mi">0</span> 
            <span class="n">j</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">while</span> <span class="n">j</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">totalItemsets</span><span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">item</span> <span class="o">==</span> <span class="n">totalItemsets</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="p">:</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span> 
                    <span class="n">totalItemsets</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="c">#remove the first occurence</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">t_supp</span> <span class="o">=</span> <span class="n">count</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span>
<span class="c">#            print(t_supp)</span>
            
            <span class="k">if</span> <span class="n">t_supp</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_supp</span><span class="p">:</span>
                <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Item</span><span class="p">([</span><span class="n">item</span><span class="p">],</span><span class="n">t_supp</span><span class="p">))</span>
            
        <span class="n">temp</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">items</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span>   <span class="n">temp</span>
    <span class="k">def</span> <span class="nf">ralationRules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">maxSequence</span><span class="p">,</span><span class="n">min_confidence</span><span class="p">):</span>
        <span class="n">ruls</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">maxSequence</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">each</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span><span class="c">#real subsets </span>
                <span class="n">subsets</span> <span class="o">=</span> <span class="n">each</span><span class="o">.</span><span class="n">getSubset</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">each</span><span class="o">.</span><span class="n">elements</span><span class="p">))</span><span class="c">#get the subsets of the i+1 events</span>
                <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">subsets</span><span class="p">:</span>
                    <span class="n">count</span><span class="o">=</span><span class="mi">0</span>
                    <span class="k">for</span> <span class="n">tran_item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                        <span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span> <span class="c">#标记subset中的每个元素都在源中出现</span>
                        <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">ele</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tran_item</span><span class="p">:</span>
                                <span class="n">flag</span><span class="o">=</span><span class="bp">True</span>
                                <span class="k">break</span>
                        <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span> <span class="c">#subset出现一次，计数</span>
                            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>  
                    <span class="n">confidence</span> <span class="o">=</span> <span class="p">(</span><span class="n">each</span><span class="o">.</span><span class="n">supp</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">/</span><span class="n">count</span>         
                    <span class="k">if</span>  <span class="n">confidence</span> <span class="o">&gt;=</span> <span class="n">min_confidence</span><span class="p">:</span> <span class="c">#confidence/the number of the frequent pattern </span>
                        <span class="n">str_rule</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">subset</span><span class="p">))</span> <span class="o">+</span> <span class="s">'--&gt;'</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">each</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span><span class="o">-</span><span class="nb">set</span><span class="p">(</span><span class="n">subset</span><span class="p">))</span>
                        <span class="n">rule</span> <span class="o">=</span><span class="n">Rule</span><span class="p">(</span><span class="n">confidence</span><span class="p">,</span><span class="n">str_rule</span><span class="p">)</span>           
                        <span class="n">ruls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ruls</span>
          
    <span class="k">def</span> <span class="nf">do</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>      
        <span class="n">ls</span> <span class="o">=</span> <span class="n">LS</span><span class="p">()</span>
        <span class="n">oneitemset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findFrequent1Itemsets</span><span class="p">()</span>
        <span class="n">ls</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">oneitemset</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">while</span> <span class="bp">False</span> <span class="o">==</span> <span class="n">ls</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
            <span class="n">cand</span> <span class="o">=</span> <span class="n">ls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">aprioriGen</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cand</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>
                <span class="k">break</span>
            <span class="k">for</span> <span class="n">each</span> <span class="ow">in</span> <span class="n">cand</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">each_src</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
        <span class="c">#            count = each_src.count(each.elements)#only count the single element,can not be used to count if containing more than 2 elements</span>
        <span class="c">#            need a function like Collection.containAll(Collection) in Java</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">each_src</span><span class="p">)</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">each</span><span class="o">.</span><span class="n">elements</span><span class="p">):</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
        <span class="c">#不是必须连续 相等才满足条件，只要元素都在里面即可</span>
        <span class="c">#                for i in range(len(each_src)):</span>
        <span class="c">#                    if each.elements == each_src[i:len(each.elements)]:</span>
        <span class="c">#                         break #no need continue ,We have supposed the elements be sequential</span>
                        <span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="k">for</span> <span class="n">just_one_e</span> <span class="ow">in</span> <span class="n">each</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                                <span class="n">flag</span> <span class="o">=</span> <span class="n">just_one_e</span> <span class="ow">in</span> <span class="n">each_src</span>
                                <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span> <span class="c">#只要有一个不在，即退出</span>
                                    <span class="k">break</span>
                        <span class="k">if</span> <span class="n">flag</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>   <span class="c">#当前候选事件都在的话，计数     </span>
                            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                           
                <span class="n">supp</span> <span class="o">=</span> <span class="n">count</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span>
                <span class="n">each</span><span class="o">.</span><span class="n">setSupport</span><span class="p">(</span><span class="n">supp</span><span class="p">)</span>
            <span class="n">ls</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">cand</span><span class="o">.</span><span class="n">getL</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">min_supp</span><span class="p">),</span> <span class="n">k</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">ls</span>
  

<span class="n">starttime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> 
<span class="n">a</span> <span class="o">=</span> <span class="n">Apriori</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span><span class="s">'apriori_blog.txt'</span><span class="p">)</span>
<span class="n">ls</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">do</span><span class="p">()</span> 
<span class="k">print</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span> 
<span class="n">endtime</span> <span class="o">=</span>  <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> 
<span class="k">print</span><span class="p">(</span><span class="s">"It takes </span><span class="si">%</span><span class="s">d milliseconds to find the above  patterns"</span> <span class="o">%</span><span class="p">((</span><span class="n">endtime</span><span class="o">-</span><span class="n">starttime</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">))</span>    
<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="n">ls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ls</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span>
<span class="n">rules</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">ralationRules</span><span class="p">(</span><span class="n">ls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ls</span><span class="o">.</span><span class="n">size</span><span class="p">())</span><span class="o">.</span><span class="n">items</span><span class="p">,</span><span class="mf">0.5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">rules</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
</code></pre>
</div>

<p>运行结果如下：</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="o">-----</span><span class="n">result</span><span class="o">--------</span>

<span class="mi">1</span><span class="o">-</span><span class="n">itemsets</span> <span class="p">:</span><span class="mi">5</span>
<span class="p">{[</span> <span class="mi">1</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.667</span><span class="p">)</span>	<span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.778</span><span class="p">)</span>	<span class="p">[</span> <span class="mi">5</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.222</span><span class="p">)</span>	<span class="p">[</span> <span class="mi">4</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.222</span><span class="p">)</span>	<span class="p">[</span> <span class="mi">3</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.667</span><span class="p">)</span>	<span class="p">}</span>
<span class="mi">2</span><span class="o">-</span><span class="n">itemsets</span> <span class="p">:</span><span class="mi">6</span>
<span class="p">{[</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.444</span><span class="p">)</span>	<span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.222</span><span class="p">)</span>	<span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.444</span><span class="p">)</span>	<span class="p">[</span> <span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.222</span><span class="p">)</span>	<span class="p">[</span> <span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.222</span><span class="p">)</span>	<span class="p">[</span> <span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.444</span><span class="p">)</span>	<span class="p">}</span>
<span class="mi">3</span><span class="o">-</span><span class="n">itemsets</span> <span class="p">:</span><span class="mi">2</span>
<span class="p">{[</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.222</span><span class="p">)</span>	<span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.222</span><span class="p">)</span>	<span class="p">}</span>
<span class="n">It</span> <span class="n">takes</span> <span class="mi">0</span> <span class="n">milliseconds</span> <span class="n">to</span> <span class="n">find</span> <span class="n">the</span> <span class="n">above</span>  <span class="n">patterns</span>


<span class="mi">3</span><span class="o">-</span><span class="n">itemsets</span> <span class="p">:</span><span class="mi">2</span>
<span class="p">{[</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.222</span><span class="p">)</span>	<span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="p">]</span> <span class="p">(</span><span class="n">support</span> <span class="p">:</span><span class="mf">0.222</span><span class="p">)</span>	<span class="p">}</span>
<span class="n">Rule</span><span class="p">:{</span><span class="s">'5'</span><span class="p">}</span><span class="o">--&gt;</span><span class="p">{</span><span class="s">'1'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">}</span>  <span class="n">confidence</span><span class="p">:</span><span class="mf">1.0</span>
<span class="n">Rule</span><span class="p">:{</span><span class="s">'1'</span><span class="p">,</span> <span class="s">'5'</span><span class="p">}</span><span class="o">--&gt;</span><span class="p">{</span><span class="s">'2'</span><span class="p">}</span>  <span class="n">confidence</span><span class="p">:</span><span class="mf">1.0</span>
<span class="n">Rule</span><span class="p">:{</span><span class="s">'2'</span><span class="p">,</span> <span class="s">'5'</span><span class="p">}</span><span class="o">--&gt;</span><span class="p">{</span><span class="s">'1'</span><span class="p">}</span>  <span class="n">confidence</span><span class="p">:</span><span class="mf">1.0</span>
<span class="n">Rule</span><span class="p">:{</span><span class="s">'1'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">}</span><span class="o">--&gt;</span><span class="p">{</span><span class="s">'5'</span><span class="p">}</span>  <span class="n">confidence</span><span class="p">:</span><span class="mf">0.5</span>
<span class="n">Rule</span><span class="p">:{</span><span class="s">'1'</span><span class="p">,</span> <span class="s">'3'</span><span class="p">}</span><span class="o">--&gt;</span><span class="p">{</span><span class="s">'2'</span><span class="p">}</span>  <span class="n">confidence</span><span class="p">:</span><span class="mf">0.5</span>
<span class="n">Rule</span><span class="p">:{</span><span class="s">'3'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">}</span><span class="o">--&gt;</span><span class="p">{</span><span class="s">'1'</span><span class="p">}</span>  <span class="n">confidence</span><span class="p">:</span><span class="mf">0.5</span>
<span class="n">Rule</span><span class="p">:{</span><span class="s">'1'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">}</span><span class="o">--&gt;</span><span class="p">{</span><span class="s">'3'</span><span class="p">}</span>  <span class="n">confidence</span><span class="p">:</span><span class="mf">0.5</span>

</code></pre>
</div>

<p><strong>有网友指出，本页代码在其python环境运行结果不正确，因其环境用的是python2.x，而本人用的环境是python3.x，在python3.x中，两个整数相除是得到小数的，而python2.x里是整数，因此导致支持度计算不正确，只需要改正本页代码中的196行和256行将分子转换成浮点即可（例如分别改为t_supp = count*1.0/self.size，supp = count*1.0/self.size）。本人初学python，一些细节不清楚，望理解。感谢网友指出。</strong></p>

<p>参考文献：</p>

<p>Jiawei Han and Micheline Kamber.Data Mining: Concepts and Techniques[M]. San Francisco: Morgan Kaufmann Publishers.2006：234-240</p>

<p><a href="http://blog.sina.com.cn/s/blog_4882f26d0100spl1.html">http://blog.sina.com.cn/s/blog_4882f26d0100spl1.html</a></p>

            </div>
            <div class="post-nav">
    
    <a class="prev" href=/blog/undergraduate-history-of-book-in-lab.html>&laquo; &nbsp;我的本科借阅史</a>
    
    
    <a class="next" href=/blog/books-of-design-pattern-recommendation.html>设计模式书籍推荐&nbsp;&raquo;</a>
    
</div>

            
        </div>
        <!--
            if config set comment enable,include comment
        -->
        
            <!-- comment -->
<div id="post-comment" class="panel panel-default">
    <div class="panel-body">
        

        
            <div id="disqus_thread"></div>
        
    </div>
</div>

        
    </div>
    <div class="col-md-3 col-sidebar">
        <div class="panel panel-pithy author">
    <div class="panel-heading avastar">
        <img src="/tx.jpg" alt="tanglei"/>
    </div>
    <div class="panel-body">
        码农 @ 宜信大数据创新中心, 毕业于CSU && THU,  曾工作于<a href='http://www.tencent.com/zh-cn/index.shtml' target='_blank'>腾讯</a> && <a href='http://www.umeng.com/' target='_blank'>友盟</a>.  &nbsp; <a href='/about/'> MORE </a>
    </div>
    <div class="panel-footer social">
        <ul>
            
            <li>
                <a rel="nofollow" href="http://www.weibo.com/tangleithu/" target="_blank"><i class="fa fa-weibo"></i></a>
            </li>
            
            <li>
                <a rel="nofollow" href="https://github.com/tl3shi" target="_blank"><i class="fa fa-github"></i></a>
            </li>
            
            <li>
                <a rel="nofollow" href="https://www.facebook.com/tanglei.name" target="_blank"><i class="fa fa-facebook"></i></a>
            </li>
            
            <li>
                <a href="https://www.tanglei.name/feed.xml" target="_blank"><i class="fa fa-rss"></i></a>
            </li>
        </ul>
    </div>
</div>

        <!-- sidebar:category list -->
<div class="panel panel-default categories">
    <div class="panel-heading title">
        分类列表
    </div>
    <div class="panel-body list">
        <ul>
          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/贵州支教行/">
                  贵州支教行&nbsp;<span class="count">[12]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/课程学习/">
                  课程学习&nbsp;<span class="count">[88]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/MyLife/">
                  MyLife&nbsp;<span class="count">[45]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/经验技巧/">
                  经验技巧&nbsp;<span class="count">[93]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/社会工作/">
                  社会工作&nbsp;<span class="count">[13]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/网络文摘/">
                  网络文摘&nbsp;<span class="count">[28]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/软件体系结构/">
                  软件体系结构&nbsp;<span class="count">[1]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/旅游/">
                  旅游&nbsp;<span class="count">[23]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/软考/">
                  软考&nbsp;<span class="count">[2]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/软件度量及其应用/">
                  软件度量及其应用&nbsp;<span class="count">[1]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/工作那些事儿/">
                  工作那些事儿&nbsp;<span class="count">[42]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/我做站长/">
                  我做站长&nbsp;<span class="count">[1]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/coding小工具/">
                  coding小工具&nbsp;<span class="count">[11]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/除臭虫/">
                  除臭虫&nbsp;<span class="count">[11]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/学到老/">
                  学到老&nbsp;<span class="count">[13]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/我不会算法/">
                  我不会算法&nbsp;<span class="count">[11]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/数据挖掘/">
                  数据挖掘&nbsp;<span class="count">[1]</span>
              </a>
          </li>

          
          <li>
              <a class="catelink" rel="bookmark" href="/categories/计算机图形学/">
                  计算机图形学&nbsp;<span class="count">[5]</span>
              </a>
          </li>

          
        </ul>
    </div>
</div>

        <!-- sidebar: tag list -->
<div class="panel panel-default tags">
    <div class="panel-heading title">
        标签云
    </div>
    <div class="panel-body list">
         
        <input type="hidden" id="tag-values" value='{"name":"丰田助学","count":16},{"name":"贵州支教","count":12},{"name":"铜厂小学","count":9},{"name":"中南大学","count":12},{"name":"云南赶集","count":1},{"name":"HelloWorld","count":5},{"name":"我做站长","count":35},{"name":"设计模式","count":7},{"name":"Wordpress","count":18},{"name":"系统架构师","count":11},{"name":"软考","count":25},{"name":"论文","count":6},{"name":"软件0804","count":8},{"name":"Java","count":24},{"name":"J2EE","count":3},{"name":"JAVA","count":1},{"name":"考试","count":25},{"name":"SEO","count":3},{"name":"软件体系结构","count":6},{"name":"Android","count":28},{"name":"软件工程","count":2},{"name":"Windows","count":17},{"name":"软件测试","count":1},{"name":"总结","count":13},{"name":"Oracle","count":4},{"name":"存储过程","count":3},{"name":"数据库应用","count":3},{"name":"数据库","count":8},{"name":"先进班集体","count":1},{"name":"Linux","count":15},{"name":"Ubuntu","count":8},{"name":"Defy","count":3},{"name":"传感器","count":1},{"name":"访日交流","count":8},{"name":"旅游","count":22},{"name":"软件学院","count":11},{"name":"大学生科协","count":4},{"name":"玩遍中国","count":11},{"name":"计算机网络","count":5},{"name":"Eclipse","count":4},{"name":"软件度量","count":11},{"name":"软件设计师","count":4},{"name":"编译原理","count":2},{"name":"程序语言","count":2},{"name":"操作系统","count":3},{"name":"多媒体","count":2},{"name":"网络安全","count":9},{"name":"TCP/IP","count":2},{"name":"编程语言","count":1},{"name":"考点","count":1},{"name":"Google","count":5},{"name":"软件结构度量","count":1},{"name":"CMM","count":6},{"name":"项目管理","count":3},{"name":"实习","count":33},{"name":"面试","count":18},{"name":"网络营销","count":1},{"name":"百度","count":4},{"name":"笔试","count":2},{"name":"腾讯","count":31},{"name":"编程比赛","count":4},{"name":"科研","count":4},{"name":"电子商务","count":11},{"name":"虚拟主机","count":2},{"name":"网路安全","count":1},{"name":"Foxmail","count":3},{"name":"微软","count":1},{"name":"软件能力成熟度模型","count":2},{"name":"软件过程改进","count":3},{"name":"SCM复习资料","count":1},{"name":"软件配置管理","count":12},{"name":"SCM","count":6},{"name":"工具","count":19},{"name":"反模式","count":1},{"name":"玩玩手机","count":5},{"name":"程序员","count":4},{"name":"健康","count":1},{"name":"共享上网","count":2},{"name":"Bug","count":4},{"name":"coding小工具","count":1},{"name":"工作日志","count":19},{"name":"Apache","count":2},{"name":"PHP","count":13},{"name":"实习日志","count":1},{"name":"工作实习生","count":1},{"name":"Mysql","count":1},{"name":"Shell","count":3},{"name":"腾讯实习日志","count":1},{"name":"hosts","count":2},{"name":"Vim","count":3},{"name":"正则表达式","count":2},{"name":"搜索引擎","count":1},{"name":"跨域","count":1},{"name":"前端","count":2},{"name":"保研","count":15},{"name":"算法","count":9},{"name":"清华大学","count":12},{"name":"丰田助学金","count":3},{"name":"WiFi","count":1},{"name":"实习生","count":1},{"name":"wifi自动关闭","count":1},{"name":"腾讯实习","count":1},{"name":"经验技巧","count":13},{"name":"DDOS","count":2},{"name":"AOP","count":3},{"name":"租房","count":2},{"name":"Sqlite","count":2},{"name":"Python","count":11},{"name":"OOP","count":5},{"name":"数据挖掘","count":8},{"name":"GitHub","count":2},{"name":"SVM","count":3},{"name":"R语言","count":2},{"name":"足迹","count":2},{"name":"笛子","count":2},{"name":"计算机图形学","count":5},{"name":"OpenGL","count":3},{"name":"回忆录","count":1},{"name":"年终总结","count":1},{"name":"域名","count":1},{"name":"计算几何","count":2},{"name":"敲敲代码","count":9},{"name":"Latex","count":3},{"name":"C++","count":10},{"name":"Mac","count":7},{"name":"飞行模式","count":2},{"name":"性能优化","count":2},{"name":"Javascript","count":1},{"name":"工作","count":1},{"name":"玩遍世界","count":1},{"name":"Scala","count":2},{"name":"MyLife","count":1},{"name":"快捷键","count":1},{"name":"云服务","count":1},{"name":"Blog","count":1},{"name":"微信公众号","count":1}'/>
        <div style="display: none"><a id="tag-value" class="taglink" rel="bookmark" href="/tag/#" data-target-cate="#"></a></div>
        <div class="tag-values-container">
        </div>
    </div>
</div>

    </div>
</div>

  </div>

  <footer>
  <div class="text-center">
    © 2010-2016 All rights reserved.
    Made with <a href="http://jekyllrb.com/" rel="nofollow" target="_blank">Jekyll</a>
    & Modified by <a href="http://www.tanglei.name/about/" >Tanglei</a>
    and <i class="fa fa-heart"></i> by <a rel="nofollow" href="https://github.com/guovz/jekyll-pithy" target="_blank">Pithy</a>
  </div>
  <div class="totop" data-toggle="totop">
      <i class="fa fa-chevron-up"></i>
  </div>
</footer>


  <!--the js include-->
<script src="/assets/vendor/jquery/jquery.min.js"></script>
<script src="/assets/vendor/bootstrap/bootstrap.min.js"></script>
<script src="/assets/script/pithy.js"></script>

<!--
  the site comment script
-->


  <script>
    
    var disqus_config = function () {
        this.page.url = 'https://www.tanglei.name/blog/apriori-algorithm-in-python.html' ; // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = '/blog/apriori-algorithm-in-python.html'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function () { // DON'T EDIT BELOW THIS LINE
        if($("#disqus_thread").length) {
            var d = document, s = d.createElement('script');
            s.src = 'https://hexo-tanglei.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        }
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments
    powered by Disqus.</a></noscript>



<!--
  the site analysis script
-->

  <!-- baidu analysis -->
<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "//hm.baidu.com/hm.js?f0117177475f54027bfcaceb8d668cee";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>




</body>
</html>
